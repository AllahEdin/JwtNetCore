on:
  push:
    branches-ignore: [master]
  pull_request:
    branches-ignore: []

jobs:
  build:

    name: Deploy Docker Image - DEV
    runs-on: [self-hosted, dev]
  
    if: github.event_name == 'push' || github.event.pull_request.head.repo.full_name != github.repository
 
    steps:
    
      - name: Checkout Code
        uses: actions/checkout@v2.3.4
   
      - name: Rmi Images
        run: docker rmi cheekibreeki228/test_repos:dev --force
        
      - name: Build Images
        run: cd src/; docker build -t cheekibreeki228/test_repos:dev .
        
      - name: Deploy Image
        run: docker push cheekibreeki228/test_repos:dev
  
      - name: Stop Service
        run: docker-compose down --rmi all
        
      - name: Start Service
        run: docker-compose up -d

